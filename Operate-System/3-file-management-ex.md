# 文件管理习题

## 文件系统

### 文件系统基础

#### 文件基本操作

**例题** 若一个用户进程通过$read$系统调用读取一个磁盘文件中的数据，则下列关于此过程的叙述中，正确的是()。

Ⅰ.若该文件的数据不在内存，则该进程进入睡眠等待状态

Ⅱ.请求$read$系统调用会导致$CPU$从用户态切换到核心态

Ⅲ.$read$系统调用的参数应包含文件的名称

$A.$仅Ⅰ、Ⅱ

$B.$仅Ⅰ、Ⅲ

$C.$仅Ⅱ、Ⅲ

$D.$Ⅰ、Ⅱ和Ⅲ

解：$A$。对于Ⅰ，当所读文件的数据不在内存时，产生中断（缺页中断），原进程进入阻塞态，直到所需数据从外存调入内存后，才将该进程唤醒。对于Ⅱ，$read$系统调用通过陷入将$CPU$从用户态切换到核心态，从而获取操作系统提供的服务。对于Ⅲ，要读一个文件，首先要用$open$系统调用打开该文件。$open$中的参数包含文件的路径名与文件名，而$read$只需使用$open$返回的文件描述符，并不使用文件名作为参数。$read$要求用户提供三个输入参数：①文件描述符$fd$；② $buf$缓冲区首址；③传送的字节数$n$。$read$的功能是试图从$fd$所指示的文件中读入$n$个字节的数据，并将它们送至由指针$buf$所指示的缓冲区中。

### 文件逻辑结构

**例题** 文件的逻辑结构是为了方便()而设计的。

$A.$存储介质特性

$B.$操作系统的管理方式

$C.$主存容量

$D.$用户

解：$D$。文件结构包括逻辑结构和物理结构。逻辑结构是用户组织数据的结构形式，数据组织形式来自需求，而物理结构是操作系统组织物理存储块的结构形式。因此说，逻辑文件的组织形式取决于用户，物理结构的选择取决于文件系统设计者针对硬件结构（如磁带介质很难实现链接结构和索引结构）所采取的策略（即$A$和$B$选项）。

### 文件共享

**例题** 若文件$f1$的硬链接为$f2$，两个进程分别打开$f1$和$f2$，获得对应的文件描述符为$fd1$和$fd2$，则下列叙述中正确的是()。

Ⅰ.$f1$和$f2$的读写指针位置保持相同

Ⅱ.$f1$和$f2$共享同一个内存索引结点

Ⅲ.$fd1$和$fd2$分别指向各自的用户打开文件表中的一项

$A.$仅Ⅲ

$B.$仅Ⅱ、Ⅲ

$c.$仅Ⅰ、Ⅱ

$D.$Ⅰ和Ⅱ、Ⅲ

解：$B$。硬链接指通过索引结点进行连接。一个文件在物理存储器上有一个索引结点号。存在多个文件名指向同一个索引结点的情况，Ⅱ正确。两个进程各自维护自己的文件描述符，Ⅲ正确，Ⅰ错误。

**例题** 若多个进程共享同一个文件$F$，则下列叙述中，正确的是()。

$A.$各进程只能用“读”方式打开文件$F$

$B.$在系统打开文件表中仅有一个表项包含$F$的属性

$C.$各进程的用户打开文件表中关于$F$的表项内容相同

$D.$进程关闭$F$时，系统删除$F$在系统打开文件表中的表项

解：$B$。多个进程可以同时以“读”或“写”的方式打开文件，操作系统并不保证写操作的互斥性，进程可通过系统调用对文件加锁，保证互斥写（读者-写者问题)，$A$错误。整个系统只有一个系统打开文件表，同一个文件打开多次只需改变引用计数，$B$正确。用户进程的打开文件表关于同一个文件不一定相同，例如读写指针位置不一定相同，$C$错误。进程关闭文件时，文件的引用计数减$1$，引用计数变为$0$时才删除系统打开文件表中的表项，$D$错误。

### 文件保护

**例题** 对一个文件的访问，常由()共同限制。

$A.$用户访问权限和文件属性

$B.$用户访问权限和用户优先级

$C.$优先级和文件属性

$D.$文件属性和口令

解：$A$。对于这道题，只要能区分用户的访问权限和用户优先级，就能得到正确的答案。用户访问权限是指用户有没有权限访问该文件，而用户优先级是指在多个用户同时请求该文件时应该先满足谁。比如，图书馆的用户排队借一本书，某用户可能有更高的优先级，即他排在队伍的前面，但有可能轮到他时被告知他没有借阅那本书的权限。文件的属性包括保存在$FCB$中对文件访问的控制信息。

**例题** 加密保护和访问控制两种机制相比，()。

$A.$加密保护机制的灵活性更好

$B.$访问控制机制的安全性更高

$C.$加密保护机制必须由系统实现

$D.$访问控制机制必须由系统实现

解：$D$。相对于加密保护机制，访问控制机制的安全性较差。因为访问控制的级别和保护力度较小，因此它的灵活性相对较高。若访问控制不由系统实现，则系统本身的安全性就无法保证。加密机制若由系统实现，则加密方法将无法扩展。

**例题** 某文件系统中，针对每个文件，用户类别分为$4$类：安全管理员、文件主、文件主的伙伴、其他用户；访问权限分为$5$种：完全控制、执行、修改、读取、写入。若文件控制块中用二进制位串表示文件权限，为表示不同类别用户对一个文件的访问权限，则描述文件权限的位数至少应为()。

$A.5$

$B.9$

$C.12$

$D.20$

解：$D$。同一类用户可能有所有可能的权限中的任一组合，所以可以把用户访问权限抽象为一个矩阵，行代表用户，列代表访问权限。这个矩阵有$4$行$5$列，$1$代表$true$，$0$代表$false$，所以需要$4\times5=20$位，选$D$。

### 文件物理结构

#### 链接分配

**例题** 设有一个记录文件，采用链接分配方式，逻辑记录的固定长度为$100B$，在磁盘上存储时采用记录成组分解技术。盘块长度为$512B$。若该文件的目录项已经读入内存，则对第$22$个逻辑记录完成修改后，共启动了磁盘()次。

$A.3$

$B.4$

$C.5$

$D.6$

解：$D$。第$22$个逻辑记录对应$4$（$22\times100\div512=4$，余$152$）个物理块，即读入第$5$个物理块，由于文件采用的物理结构是链接文件，因此需要从目录项所指的第一个物理块开始读取，依次读到第$4$块才得到第$5$块的物理地址，共启动磁盘$5$次。修改还需要写回操作，由于写回时已获得该块的物理地址，只需$1$次访问磁盘，因此共需要启动磁盘$6$次。

#### 索引分配

**例题** 假设磁盘块大小为$1KB$，一个索引表项占$4B$，求文件最大长度。

解：若磁盘块大小为$1KB$，一个索引表项占$4B$，则一个磁盘块只能存放$1\times1024\div4=256$个索引项。

若某文件采用两层索引，则该文件的最大长度，就是所有索引都用来指向一个文件的数据，所以可以到$256\times256\times1KB=65536KB=64MB$。

**例题** 设文件索引结点中有$7$个地址项，其中$4$个地址项是直接地址索引，$2$个地址项是一级间接地址索引，$1$个地址项是二级间接地址索引，每个地址项大小为$4B$若磁盘索引块和磁盘数据块大小均为$256B$，则可表示的单个文件最大长度是()。

$A.33KB$

$B.519KB$

$C.1057KB$

$D.16516KB$

解：每个磁盘索引块和磁盘数据块大小均为$256B$，每个磁盘索引块有$256\div4=64$个地址项。因此，$4$个直接地址索引指向的数据块大小为$4\times256B$；$2$个一级间接索引包含的直接地址索引数为$2\times(256\div4)$，即其指向的数据块大小为$2\times(256\div4)\times256B$。$1$个二级间接索引所包含的直接地址索引数为$(256\div4)\times(256\div4)$，即其所指向的数据块大小为$(256\div4)\times(256\div4)\times256B$。因此，$7$个地址项所指向的数据块总大小为$4\times256+2\times(256\div4)\times256+(256\div4)\times(256\div4)\times256=1082368B=1057KB$。

**例题** 某文件系统的目录项由文件名和索引结点号构成。若每个目录项长度为$64$字节，其中$4$字节存放索引结点号，$60$字节存放文件名。文件名由小写英文字母构成，则该文件系统能创建的文件数量的上限为()。

$A.2^{26}$

$B.2^{32}$

$C.2^{60}$

$D.2^{64}$

解：$B$。此题容易按照$60$位来计算，任务$60$字节就可以表示出$2^{60}$种不同的名称组合。但是实际上只需要看索引节点长度，因为索引长度代表可支持的索引数量的数量大小，而不同的文件目录可以同名，所以只用看索引节点的个数就可以了，$4B=32bit$，所以就是$2^{32}$个。

#### 检索方法

**例题** 下列关于目录检索的论述中，正确的是()。

$A.$由于散列法具有较快的检索速度，因此现代操作系统中都用它来替代传统的顺序检索方法

$B.$在利用顺序检索法时，对树形目录应采用文件的路径名，且应从根目录开始逐级检索

$C.$在利用顺序检索法时，只要路径名的一个分量名未找到，就应停止查找

$D.$利用顺序检索法查找完成后，即可得到文件的物理地址

解：$C$。选项$A$中的方法不利于对文件顺序检索，也不利于文件枚举，一般采用线性检索法；选项$B$中，为了加快文件查找速度，可以设立当前目录，于是文件路径可从当前目录进行查找；选项$D$中，在顺序检索法查找完成后，得到的是文件的逻辑地址。

### 文件存储空间管理

#### 位示图

若序号从$1$开始，$i$代表行，$j$代表列，$n$为字长，即每行位数，盘块号为$b=n(i-1)+j$，$i=(b-1)\div n+1$，$j=(b-1)\mod n+1$。

若用$8$个字（字长$32$位）组成的位示图管理内存，假定用户归还一个块号为$100$的内存块时，它对应位示图的位置为()。

$A.$字号为$3$，位号为$5$

$B.$字号为$4$，位号为$4$

$C.$字号为$3$，位号为$4$

$D.$字号为$4$，位号为$5$

解：$B$。$8$个字，字长$32$位，则代表位图为$8$行$32$列。字号就是行号：$(100-1)\div32+1=4$，位号就是列号：$(100-1)\mod32+1=4$。