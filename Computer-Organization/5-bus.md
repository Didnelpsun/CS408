# 总线

## 总线概述

### 总线基本定义

+ 总线是一组能为多个部件分时共享的公共信息传送线路。
+ 共享是指总线上可以挂接多个部件，各个部件之间互相交换的信息都可以通过这组线路分时共享。
+ 分时是指同一时刻只允许有一个部件向总线发送信息，如果系统中有多个部件，则它们只能分时地向总线发送信息。
+ 早期计算机外部设备少时大多采用分散连接方式，不易实现随时增减外部设备。为了更好地解决I/O设备和主机之间连接的灵活性问题，计算机的结构从分散连接发展为总线连接。
+ 总线特性：
  1. 机械特性：尺寸、形状、管脚数、排列顺序。
  2. 电气特性：传输方向和有效的电平范围。
  3. 功能特性：每根传输线的功能（地址、数据、控制）。
  4. 时间特性：信号的时序关系

### 总线分类

+ 数据传输格式：
  + 串行总线：
    + 优点：只需要一条传输线,成本低廉，广泛应用于长距离传输；应用于计算机内部时，可以节省布线空间。
    + 缺点：在数据发送和接收的时候要进行拆卸和装配，要考虑串行并行转换的问题。
  + 并行总线：
    + 优点：总线的逻辑时序比较简单，电路实现起来比较容易。
    + 缺点：信号线数量多，占用更多的布线空间;远距离传输成本高昂；由于工作频率较高时，并行的信号线之间会产生严重影响，对每条线等长的要求也越来越难以无法持续提升工作频率。
+ 总线功能（连接部件）：
  + 片内总线：片内总线是芯片内部的总线。
它是CPU芯片内部寄存器与寄存器之间、寄存器与ALU之间的公共连接线。
  + 系统总线：系统总线是计算机系统内各功能部件（CPU、主存、I/O接口）之间相互连接的总线。按系统总线传输信息内容的不同，又可分为：
    + 数据总线DB：传输各功能部件之间的数据信息,包括指令和操作数；位数（根数）与机器字长、存储字长有关；双向。
    + 地址总线AB：传输地址信息，包括主存单元或I/O端口的地址；位数（根数与主存地址大小及设备数量有关）；单向。
    + 控制总线CB：传输控制信息；一根控制线传输一个信号；有出：CPU送出的控制命令；有入：主存（或外设）返回CPU的反馈信号。
  + 通信总线：通信总线是用于计算机系统之间或计算机系统与其他系统（如远程通信设备、测试设备）之间信息传送的总线，通信总线也称为外部总线。
+ 时序控制方式：
  + 同步总线。
  + 异步总线。

### 总线结构

+ 单总线结构：
  + CPU、主存、IO设备（通过IO接口）都连接在一组总线上，允许I/O设备之间、I/O设备和CPU之间或I/O设备与主存之间直接交换信息。
  + 单总线并不是指只有一根信号线，系统总线按传送信息的不同可以细分为地址总线、数据总线和控制总线。
  + 优点：结构简单，成本低，易于接入新的设备。
  + 缺点：带宽低、负载重，多个部件只能争用唯一的总线，且不支持并发传送操作。
+ 双总线结构：
  + 双总线结构有两条总线，一条是主存总线，用于CPU、主存和通道之间进行数据传送；另一条是I/O总线（因为I/O速度较慢），用于多个外部设备与通道之间进行数据传送。
  + 通道是具有特殊功能的处理器，能对I/O设备进行统一管理。通道程序放在主存中。
  + 支持突发（猝发）传送：送出一个地址，收到多个地址连续的数括。
  + 优点：将较低速的I/O设备从单总线上分离出来，实现存储器总线和I/O总线分离。
  + 缺点：需要增加通道等硬件设备。
+ 三总线结构：
  + 三总线结构是在计算机系统各部件之间采用三条各自独立的总线来构成信息通路，分别为：
    + 主存总线：CPU和主存之间的连接。
    + I/O总线：CPU和I/O接口之间连接。
    + DMA总线：Direct Memory Access，直接内存访问，连接外设与主存。能直接连接主存的就是高速外设，如磁盘机，而无法直接连接主存的就是低速外设，如打印机和显示器。
  + 优点：提高了I/O设备的性能，使其更快地响应命令，提高系统吞吐量。
  + 缺点：系统工作效率较低。
+ 四总线结构：
  + 四总线结构一共四条中线：
    + CPU总线（局部总线）：CPU与Cache。
    + 系统总线：CPU和主存。
    + 高速总线：连接SCSI、图形、多媒体、局域网。
    + 扩充总线（扩展总线型）：连接传真机、扩展总线接口、调制解调器、串行接口。
  + 桥接器：用于连接不同的总线，具有数据缓冲、转换和控制功能。
  + 越靠近CPU总线速度越快，CPU总线>系统总线>高速总线>扩充总线。
  + 每级总线的设计遵循总线标准。

### 性能指标

#### 传输周期

也称为总线周期。一次总线操作所需的时间（包括申请阶段、寻址阶段、传输阶段和结束阶段），通常由若干个总线时钟周期构成。

#### 时钟周期

即机器的时钟周期。计算机有一个统一的时钟，以控制整个计算机的各个部件，总线也要受此时钟的控制。

#### 工作频率

总线上各种操作的频率，为总线周期的倒数。

若总线周期=N个时钟周期,则总线的工作频率=时钟频率/N。

#### 时钟频率

即机器的时钟频率，为时钟周期的倒数。若时钟周期为T，则时钟频率为1/T。

实际上指一秒内有多少个时钟周期。

#### 总线宽度

又称为总线位宽，它是总线上同时能够传输的数据位数，通常是指数据总线的根数，如32根称为32位（bit）总线。

#### 总线带宽

可理解为总线的数据传输率，即单位时间内总线上可传输数据的位数，通常用每秒钟传送信息的字节数来衡量，单位可用字节/秒（B/s）表示。

总线带宽=总线工作频率×总线宽度（bit/s）=总线工作频率×(总线宽度/8)（B/s）=总线宽度/总线周期（bit/s）=总线宽度/8/总线周期（B/s）。

总线带宽是指总线本身所能达到的最高传输速率。

在计算实际的有效数据传输率时，要用实际传输的数据量除以耗时。

**例题** 某同步总线采用数据线和地址线复用方式，其中地址/数据线有32根，总线时钟频率为66MHz，每个时钟周期传送两次数据（上升沿和下降沿各传送一次数据）。

1）该总线的最大数据传输率（总线带宽）是多少？

因为每个时钟周期传送两次数据，所以总线工作频率是时钟周期的两倍=2×66MHz=132MHz。

又总线根数为32，所以总线宽度=32bit=4B。

总线带宽=132M×4B/s=528MB/s。

2）若该总线支持突发（猝发）传输方式，传输一个地址占用一个时钟周期，则一次“主存写”总线事务传输128位数据所需要的时间至少是多少？


#### 总线复用

#### 信号线数

## 总线仲裁

解决多个设备争用总线的问题。

## 总线操作与定时

占用总线的一对设备进行数据传输的方法。

## 总线标准
